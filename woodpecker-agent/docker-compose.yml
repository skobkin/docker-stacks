# https://hub.docker.com/r/woodpeckerci/woodpecker-agent

services:
  woodpecker-agent:
    image: 'woodpeckerci/woodpecker-agent:${IMAGE_TAG:-latest}'
    container_name: woodpecker-agent
    volumes:
      - '/var/run/docker.sock:/var/run/docker.sock'
    # Optional HTTP health/metrics endpoint; enable port mapping only if you need host access
    #ports:
    #  - '${WEBUI_BIND_ADDR:-127.0.0.1}:${WEBUI_BIND_PORT:-8391}:3000'
    env_file: .env
    environment:
      - WOODPECKER_SERVER=${WOODPECKER_SERVER:-woodpecker:9400}
      - WOODPECKER_AGENT_SECRET=${WOODPECKER_AGENT_SECRET:-super-duper-secret}
      - WOODPECKER_MAX_WORKFLOWS=${WOODPECKER_MAX_WORKFLOWS:-2}
      - WOODPECKER_BACKEND=${WOODPECKER_BACKEND:-docker}
      - WOODPECKER_BACKEND_DOCKER_NETWORK=${WOODPECKER_BACKEND_DOCKER_NETWORK:-}
      - WOODPECKER_HEALTHCHECK_ADDR=${WOODPECKER_HEALTHCHECK_ADDR:-:3000}
      - WOODPECKER_LOG_LEVEL=${WOODPECKER_LOG_LEVEL:-info}
    restart: unless-stopped
    logging:
      driver: 'json-file'
      options:
        max-size: '${LOG_MAX_SIZE:-5m}'
        max-file: '${LOG_MAX_FILE:-5}'
